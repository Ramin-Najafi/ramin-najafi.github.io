<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Linen ‚Äî your personal memory assistant, supporting memories, reminders, and mental health.">
<meta name="theme-color" content="#000000">
<title>Linen ‚Äî Your Personal Assistant</title>
<link rel="icon" type="image/png" sizes="192x192" href="./icon-192.png">
<link rel="apple-touch-icon" href="./icon-192.png">
<link rel="manifest" href="./manifest.json">
<link rel="stylesheet" href="./styles.css">
</head>
<body>

<div id="onboarding-overlay">
    <div id="onboarding-wizard">
        <div class="step" id="step-1">
            <img src="./logo.png" alt="Linen Logo" class="onboarding-logo">
            <h1>Linen</h1>
            <p>Your AI companion that remembers everything.</p>
            <button id="get-started">Get Started</button>
        </div>
        <div class="step" id="step-2">
            <button class="back-btn" id="back-from-step-2">‚Üê Back</button>
            <h2>Choose Your AI</h2>
            <p>Pick your favorite AI assistant. All are supported by Linen.</p>
            <div class="ai-provider-grid">
                <button class="ai-provider-btn" data-provider="gemini" id="provider-gemini">
                    <span class="provider-icon">üîµ</span>
                    <span class="provider-name">Gemini</span>
                    <span class="provider-info">Free tier available</span>
                </button>
                <button class="ai-provider-btn" data-provider="chatgpt" id="provider-openai">
                    <span class="provider-icon">üü¢</span>
                    <span class="provider-name">ChatGPT</span>
                    <span class="provider-info">GPT-4 / GPT-4 Turbo</span>
                </button>
                <button class="ai-provider-btn" data-provider="claude" id="provider-claude">
                    <span class="provider-icon">üî¥</span>
                    <span class="provider-name">Claude</span>
                    <span class="provider-info">Claude Pro / API</span>
                </button>
                <button class="ai-provider-btn" data-provider="deepseek" id="provider-deepseek">
                    <span class="provider-icon">üü†</span>
                    <span class="provider-name">DeepSeek</span>
                    <span class="provider-info">Free & affordable</span>
                </button>
            </div>
            <div id="provider-setup">
                <!-- Provider-specific setup will be shown here -->
            </div>
            <p class="error-message" id="onboarding-error"></p>
        </div>
        <div class="step" id="step-3">
            <button class="back-btn" id="back-from-step-3">‚Üê Back</button>
            <h2>Install as App</h2>
            <p>What device are you using?</p>
            <div class="device-selector">
                <button data-device="android">Android</button>
                <button data-device="ios">iOS</button>
            </div>
            <div id="android-instructions" class="instructions">
                <h4 style="margin-bottom: 0.5rem;">Android (Chrome)</h4>
                <ol>
                    <li>In Chrome, tap the <strong>three-dot menu (‚ãÆ)</strong> in the top-right corner</li>
                    <li>Tap <strong>"Add to Home screen"</strong></li>
                    <li>A popup will appear‚Äîtap the <strong>"Add"</strong> button</li>
                    <li>Linen will appear on your home screen as an app icon</li>
                </ol>
                <p style="font-size: 0.85rem; color: var(--text-light); margin-top: 0.5rem;"><em>Tip: Chrome may show an automatic "Install" prompt when you visit Linen‚Äîyou can tap that too!</em></p>
            </div>
            <div id="ios-instructions" class="instructions">
                <h4 style="margin-bottom: 0.5rem;">iOS (Safari)</h4>
                <ol>
                    <li>In Safari, tap the <strong>Share button</strong> (looks like a box with an arrow ‚¨ÜÔ∏è) at the bottom of your screen</li>
                    <li>Scroll down in the share menu and tap <strong>"Add to Home Screen"</strong></li>
                    <li>You can customize the app name if you want</li>
                    <li>Tap the <strong>"Add"</strong> button in the top-right corner</li>
                    <li>Linen will appear on your home screen as an app icon</li>
                </ol>
                <p style="font-size: 0.85rem; color: var(--text-light); margin-top: 0.5rem;"><em>Tip: You can also use Chrome, Firefox, or Edge instead of Safari‚Äîthey all work the same way!</em></p>
            </div>
            <div class="onboarding-nav">
                <button id="finish-onboarding">Done</button>
            </div>
        </div>
        <div class="step-indicator">
            <span class="dot active"></span>
            <span class="dot"></span>
            <span class="dot"></span>
        </div>
    </div>
</div>

<div id="pitch-modal" class="modal pitch-accordion">
    <h2>Welcome to Linen</h2>
    <p>Your AI companion that respects your privacy.</p>

    <!-- Pitch Content -->
    <div class="pitch-content">
        <p class="pitch-description">Linen is a personal AI assistant that actually respects your privacy. Unlike other apps, everything you talk to Linen about stays on your device‚Äîwe don't sell your data or train on your conversations. It learns who you are over time, remembers what matters to you, and helps with reminders, planning, or just being there when you need support. Think of it as an AI that's actually on your side.</p>

        <!-- Start Chatting Now - Accordion Dropdown -->
        <div class="accordion-container">
            <div class="accordion-item">
                <button class="accordion-header" data-section="start">
                    <span>‚ö° Start Chatting Now</span>
                    <span class="accordion-icon">‚ñº</span>
                </button>
                <div class="accordion-content" id="start">
                    <p>Start chatting right now with Linen's built-in AI. It's a great listener and helpful friend. Want even smarter features? Add your favorite AI provider's API key anytime to unlock memories, reminders, and deeper conversations.</p>
                    <p style="font-size: 0.9rem; color: #999;"><strong>Your conversations with Linen always stay private on your device‚Äîthe API key only tells Linen which AI service you prefer to use.</strong></p>
                </div>
            </div>
        </div>

        <div class="pitch-section">
            <h3>Works With Your Favorite AI:</h3>
            <div class="provider-badges">
                <span class="badge">üîµ Gemini</span>
                <span class="badge">üü¢ ChatGPT</span>
                <span class="badge">üî¥ Claude</span>
                <span class="badge">üü† DeepSeek</span>
            </div>
        </div>

        <div class="pitch-section">
            <h3>Key Features:</h3>
            <ul class="pitch-features">
                <li>üîí Privacy First</li>
                <li>üß† Personalized</li>
                <li>üë§ You Own Your Data</li>
                <li>ü§ñ Use Your Favorite AI</li>
                <li>üí¨ Start Chatting Immediately</li>
            </ul>
        </div>
    </div>

    <div class="pitch-buttons">
        <button id="close-pitch-modal" class="button-primary">Start Chatting</button>
        <button id="add-api-key-btn" class="button-secondary">Add My API Key</button>
    </div>
</div>

<div id="trial-limit-modal" class="modal">
    <h2>Free Preview Complete</h2>
    <p>You've used your 3 free chats. Get your own API key to continue chatting unlimitedly.</p>
    <a href="https://aistudio.google.com/app/apikey" target="_blank" class="button-primary">Get Free API Key</a>
    <button id="close-trial-modal" class="button-primary">Close</button>
</div>

<div id="re-enter-key-modal" class="modal">
    <h2>Invalid API Key</h2>
    <p>Your API key is no longer working. Please enter a new one to continue.</p>
    <input type="password" id="re-enter-api-key" placeholder="Paste your new API key here">
    <button id="save-re-enter-api-key">Save Key</button>
    <p class="error-message" id="re-enter-error"></p>
</div>

<div id="voice-modal" class="modal voice-lightbox">
    <button class="close-modal" id="close-voice-modal">√ó</button>
    <h2>Voice Input</h2>
    <div id="lightbox-voice-display" class="lightbox-voice-display">üé§ Listening...</div>
    <button id="lightbox-stop-btn" class="button-primary">Stop Recording</button>
</div>

<div id="crisis-modal" class="modal crisis-modal">
    <button class="close-modal" id="close-crisis-modal">√ó</button>
    <h2 style="color: #ff6b6b;">You're Not Alone</h2>
    <p style="color: #fff; font-size: 1.1rem; margin: 1.5rem 0;">If you're in crisis, please reach out to someone who can help:</p>
    <div class="crisis-resources">
        <div class="resource">
            <h3>United States</h3>
            <p><strong>988 Suicide & Crisis Lifeline</strong></p>
            <p>Call or text 988 (available 24/7)</p>
            <p><a href="https://988lifeline.org" target="_blank" style="color: #4a9eff;">988lifeline.org</a></p>
        </div>
        <div class="resource">
            <h3>International</h3>
            <p><strong>Find Your Country's Crisis Line</strong></p>
            <p><a href="https://findahelpline.com" target="_blank" style="color: #4a9eff;">findahelpline.com</a></p>
            <p><a href="https://www.befrienders.org" target="_blank" style="color: #4a9eff;">befrienders.org</a></p>
        </div>
        <div class="resource">
            <h3>Text-Based Support</h3>
            <p><strong>Crisis Text Line</strong></p>
            <p>Text HOME to 741741 (US)</p>
            <p><a href="https://www.crisistextline.org" target="_blank" style="color: #4a9eff;">crisistextline.org</a></p>
        </div>
    </div>
    <p style="color: #ddd; margin-top: 2rem; font-size: 0.95rem;">I'm here to listen and support you, but if you're in immediate danger, please call emergency services (911 in US) or go to your nearest emergency room.</p>
    <button id="acknowledge-crisis" class="button-primary">I'm Safe / Need to Talk</button>
</div>


<div id="add-agent-modal" class="modal">
    <button class="close-modal" id="close-add-agent">√ó</button>
    <h2>Add New Agent</h2>
    <div class="form-group">
        <label for="agent-name">Agent Name:</label>
        <input type="text" id="agent-name" placeholder="e.g., My Claude, ChatGPT Pro">
        <span class="form-help">Give your agent a nickname to remember it</span>
        <span class="form-field-error" id="agent-name-error"></span>
    </div>
    <div class="form-group">
        <label for="agent-type">AI Provider:</label>
        <select id="agent-type">
            <option value="">Select a provider</option>
            <option value="gemini">Google Gemini</option>
            <option value="openai">OpenAI (ChatGPT)</option>
            <option value="claude">Anthropic Claude</option>
            <option value="deepseek">DeepSeek</option>
            <option value="openrouter">OpenRouter</option>
        </select>
        <span class="form-help">Choose your preferred AI provider</span>
        <span class="form-field-error" id="agent-type-error"></span>
    </div>
    <div class="form-group">
        <label for="agent-api-key">API Key:</label>
        <input type="password" id="agent-api-key" placeholder="Paste your API key">
        <span class="form-help">Your API key is stored locally. We never see it or send it anywhere.</span>
        <span class="form-field-error" id="agent-api-key-error"></span>
    </div>
    <div class="form-group">
        <label for="agent-model">Model (optional):</label>
        <input type="text" id="agent-model" placeholder="e.g., gpt-4, claude-3-opus">
        <span class="form-help">Leave blank to use default. Examples: gpt-4, claude-3-opus</span>
    </div>
    <div class="form-group">
        <label>
            <input type="checkbox" id="agent-primary">
            Set as primary agent
        </label>
    </div>
    <button id="save-new-agent" class="button-primary">Add Agent</button>
    <p class="error-message" id="add-agent-error"></p>
</div>

<div id="app-container">
    <a href="#chat-input" class="skip-link" id="skip-to-chat">Skip to main chat</a>
    <header>
        <div class="header-logo-container">
            <img src="./logo.png" alt="Linen Logo" id="logo" class="interactive-logo">
            <div id="logo-menu" class="logo-menu hidden">
                <button id="logo-memories" class="menu-item">üìö Memories</button>
                <button id="logo-new-chat" class="menu-item">üí¨ New Chat</button>
                <button id="logo-settings" class="menu-item">‚öô Settings</button>
            </div>
        </div>
    </header>

    <main class="main-content" id="chat-view">
        <div id="chat-messages"></div>
        <div id="chat-input-area">
            <!-- Default state: Hamburger + Input + Two buttons -->
            <div id="input-default-row" class="input-default-row">
                <button id="hamburger-menu-btn" class="hamburger-menu-btn" aria-label="Open navigation menu" title="Open navigation menu">&#9776;</button>
                <textarea id="chat-input" placeholder="Ask me anything..." rows="1"></textarea>
            </div>
            <div id="input-buttons" class="input-buttons">
                <button id="chat-type" class="input-btn" aria-label="Switch to text input mode" title="Type message">Text</button>
                <button id="chat-talk" class="input-btn" aria-label="Switch to voice input mode" title="Voice input">Talk</button>
            </div>

            <!-- Text input mode -->
            <div id="text-input-mode" class="input-mode" style="display: none;">
                <div class="input-actions">
                    <button id="mode-switcher" class="mode-btn" title="Switch mode">+</button>
                    <button id="send-btn" class="send-btn">Send</button>
                </div>
            </div>

            <!-- Voice input mode -->
            <div id="voice-input-mode" class="input-mode" style="display: none;">
                <div id="voice-status-display" class="voice-status-display">üé§ Listening...</div>
                <div class="input-actions">
                    <button id="voice-mode-switcher" class="mode-btn" title="Switch mode">+</button>
                    <button id="stop-voice-btn" class="send-btn">Stop</button>
                </div>
            </div>
        </div>
    </main>

    <div id="voice-status"></div>

    <!-- Modals and Panels -->
    <div id="modal-backdrop"></div>

    <aside id="memories-panel" aria-label="Memories sidebar">
        <button class="close-panel" id="close-memories">√ó</button>
        <input id="memory-search" placeholder="Search memories...">
        <div id="memories-list"></div>
    </aside>

    <div class="modal" id="settings-modal" aria-label="Settings panel">
        <button class="close-modal" id="close-settings-modal">√ó</button>

        <div class="settings-section" id="profile-section">
            <h3 class="settings-heading">üë§ User Profile</h3>
            <div id="profile-form" class="profile-form">
                <div class="form-group">
                    <label for="profile-first-name">First Name</label>
                    <input type="text" id="profile-first-name" placeholder="Your first name" autocomplete="given-name">
                </div>
                <div class="form-group">
                    <label for="profile-last-name">Last Name</label>
                    <input type="text" id="profile-last-name" placeholder="Your last name" autocomplete="family-name">
                </div>
                <div class="form-group">
                    <label for="profile-email">Email (optional)</label>
                    <input type="email" id="profile-email" placeholder="your@email.com" autocomplete="email">
                </div>
                <div class="form-group">
                    <label for="profile-pronouns">Pronouns</label>
                    <select id="profile-pronouns">
                        <option value="">Select pronouns</option>
                        <option value="he/him">he/him</option>
                        <option value="she/her">she/her</option>
                        <option value="they/them">they/them</option>
                        <option value="custom">Custom</option>
                    </select>
                    <input type="text" id="profile-pronouns-custom" placeholder="Enter your pronouns" style="display:none; margin-top:8px;">
                </div>
                <div class="form-group" id="profile-dob-group">
                    <label for="profile-dob">Date of Birth</label>
                    <input type="date" id="profile-dob">
                    <span class="form-help">Used for birthday messages ‚Äî stored only on your device</span>
                </div>
                <div id="profile-dob-saved" class="profile-dob-saved" style="display:none;">
                    <span>‚úì Birthday saved</span>
                </div>
                <div class="form-group">
                    <label for="profile-timezone">Timezone</label>
                    <select id="profile-timezone">
                        <option value="">Auto-detect</option>
                    </select>
                </div>
                <div class="settings-btn-group" style="margin-top: 8px;">
                    <button id="save-profile" class="settings-btn settings-btn-primary">Save Profile</button>
                    <button id="clear-profile" class="settings-btn settings-btn-danger">Clear Profile Data</button>
                </div>
            </div>
        </div>

        <div class="settings-section">
            <h3 class="settings-heading">üì± Installation</h3>
            <button id="install-app-btn" class="settings-btn settings-btn-primary">Install Linen as App</button>
        </div>

        <div class="settings-section">
            <h3 class="settings-heading">ü§ñ AI Agents</h3>
            <button id="add-agent-btn" class="settings-btn settings-btn-primary">+ Add New Agent</button>
            <div id="agents-list"></div>
        </div>

        <div class="settings-section">
            <h3 class="settings-heading">üîë Legacy API Key</h3>
            <input id="api-key-input" placeholder="Paste Gemini API key">
            <p id="settings-error" class="error-message"></p>
            <button id="save-api-key" class="settings-btn settings-btn-primary">Save API Key</button>
        </div>

        <div class="settings-section">
            <h3 class="settings-heading">üóÇÔ∏è Data Management</h3>
            <div class="settings-btn-group">
                <button id="export-data" class="settings-btn settings-btn-secondary">Export Memories</button>
                <button id="clear-chat-history" class="settings-btn settings-btn-danger">Clear Chat History</button>
                <button id="clear-data" class="settings-btn settings-btn-danger">Clear All Data</button>
            </div>
        </div>

        <div class="settings-section">
            <h3 class="settings-heading">üì¨ Contact Support</h3>
            <div id="contact-form">
                <input type="text" id="contact-name" placeholder="Your Name">
                <input type="email" id="contact-email" placeholder="Your Email">
                <textarea id="contact-message" placeholder="Your Message"></textarea>
                <button id="submit-contact" class="settings-btn settings-btn-primary">Send</button>
                <p id="contact-status" class="settings-status"></p>
            </div>
        </div>

        <div class="settings-section">
            <h3 class="settings-heading">üí° Suggestions & Ideas</h3>
            <div id="suggestions-form">
                <textarea id="suggestion-text" placeholder="What would make Linen better for you?"></textarea>
                <button id="submit-suggestion" class="settings-btn settings-btn-primary">Send Suggestion</button>
                <p id="suggestion-status" class="settings-status"></p>
            </div>
        </div>

        <div class="settings-section" id="privacy-section">
            <h3 class="settings-heading">üîê Privacy & Terms</h3>
            <div class="trust-badges">
                <div class="trust-badge">
                    <span class="trust-badge-icon">üîí</span>
                    <div class="trust-badge-text">
                        <strong>Privacy First</strong>
                        <span>Your data never leaves your device</span>
                    </div>
                </div>
                <div class="trust-badge">
                    <span class="trust-badge-icon">üö´</span>
                    <div class="trust-badge-text">
                        <strong>Never</strong>
                        <span>Sell, share, or train AI on your data</span>
                    </div>
                </div>
                <div class="trust-badge">
                    <span class="trust-badge-icon">üíØ</span>
                    <div class="trust-badge-text">
                        <strong>Free</strong>
                        <span>No paywalls, no premium, no ads</span>
                    </div>
                </div>
            </div>
            <div class="settings-btn-group">
                <button id="show-privacy-policy" class="settings-btn settings-btn-secondary">Privacy Policy</button>
                <button id="show-terms" class="settings-btn settings-btn-secondary">Terms of Service</button>
            </div>
        </div>

        <p id="version-info">v1.1.5 [beta]</p>
    </div>
</div>

<div id="privacy-modal" class="modal privacy-terms-modal">
    <button class="close-modal" id="close-privacy-modal">√ó</button>
    <h2>Linen Privacy Policy</h2>
    <div class="privacy-terms-content">
        <p class="privacy-highlight">Your privacy is Linen's #1 priority.</p>

        <h3>What Data Linen Stores</h3>
        <ul>
            <li>Your name, email, pronouns, birthday (only if you add them)</li>
            <li>Your conversations with Linen</li>
            <li>Your calendar events and reminders</li>
            <li>Your API keys (stored locally)</li>
            <li>Nothing else.</li>
        </ul>

        <h3>Where Your Data Lives</h3>
        <ul>
            <li>100% on YOUR device (your phone, your computer)</li>
            <li>Linen cannot access it</li>
        </ul>

        <h3>What Linen Does Not Do</h3>
        <ul class="privacy-never-list">
            <li>Never sells your data</li>
            <li>Never shares your data with anyone</li>
            <li>Never uses your data for ads or marketing</li>
            <li>Never trains AI models on your conversations</li>
            <li>Never accesses your device</li>
            <li>Never tracks you</li>
            <li>Never stores your data on any server</li>
        </ul>

        <h3>Your API Keys</h3>
        <ul>
            <li>Your ChatGPT, Claude, Gemini keys stay on YOUR device</li>
            <li>Linen cannot access them</li>
            <li>Only used locally by Linen</li>
            <li>Delete them anytime, they're gone forever</li>
        </ul>

        <h3>Email (If You Opt-In)</h3>
        <ul>
            <li>You can optionally provide your email</li>
            <li>Linen only sends emails if you enable notifications</li>
            <li>Unsubscribe anytime</li>
        </ul>

        <h3>Third Parties</h3>
        <ul>
            <li>If you choose to use external AI providers (ChatGPT, Claude, Gemini), they receive only what you send them</li>
            <li>Read their privacy policies to understand their practices</li>
            <li>Linen has no access to your API usage or data sent to them</li>
        </ul>

        <h3>Data Deletion</h3>
        <ul>
            <li>"Clear All Data" button in Settings permanently deletes everything</li>
            <li>No backups, no archives, no recovery</li>
            <li>Your data is completely yours to delete</li>
        </ul>

        <h3>Policy Changes</h3>
        <ul>
            <li>If this policy ever changes, you'll be notified in-app</li>
            <li>Changes will never reduce your privacy protections</li>
        </ul>

        <p class="privacy-date">Last updated: February 2026</p>
    </div>
    <button id="close-privacy-btn" class="button-primary" style="margin-top: 1rem;">Got It</button>
</div>

<div id="terms-modal" class="modal privacy-terms-modal">
    <button class="close-modal" id="close-terms-modal">√ó</button>
    <h2>Linen Terms of Service</h2>
    <div class="privacy-terms-content">
        <h3>You Own Your Data</h3>
        <ul>
            <li>Everything you create belongs to you</li>
            <li>Export it, delete it, modify it ‚Äî it's yours</li>
        </ul>

        <h3>Linen Provides the App As-Is</h3>
        <ul>
            <li>Free to use (as long as operational costs allow)</li>
            <li>Works offline, on your device</li>
            <li>No account required</li>
        </ul>

        <h3>You're Responsible For</h3>
        <ul>
            <li>Your API keys ‚Äî keep them secret, don't share them</li>
            <li>Your device security</li>
            <li>What you use Linen for</li>
        </ul>

        <h3>Linen is Not Liable For</h3>
        <ul>
            <li>Lost data (keep backups)</li>
            <li>Device crashes or errors</li>
            <li>Third-party service outages</li>
            <li>Internet connection issues</li>
        </ul>

        <h3>No Warranty</h3>
        <ul>
            <li>Linen is provided as-is without guarantees</li>
            <li>We try to keep it reliable, but bugs happen</li>
            <li>Not responsible for unexpected crashes</li>
        </ul>

        <h3>Data Ownership</h3>
        <ul>
            <li>You own all data you create in Linen</li>
            <li>You can delete it anytime</li>
            <li>Linen cannot delete your data without your permission</li>
        </ul>

        <h3>Termination</h3>
        <ul>
            <li>Stop using Linen anytime</li>
            <li>All your data stays yours</li>
        </ul>

        <p class="privacy-terms-law">Governing Law: Ontario, Canada</p>
        <p class="privacy-date">Last updated: February 2026</p>
    </div>
    <button id="close-terms-btn" class="button-primary" style="margin-top: 1rem;">Got It</button>
</div>

<div id="toast"></div>

<script src="./app.js"></script>
</body>
</html>