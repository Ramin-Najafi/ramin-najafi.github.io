<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Linen â€” your personal memory assistant, supporting memories, reminders, and mental health.">
<meta name="theme-color" content="#000000">
<title>Linen â€” Your Personal Assistant</title>
<link rel="icon" href="./favicon.svg">
<link rel="manifest" href="./manifest.json">
<link rel="stylesheet" href="./styles.css">
</head>
<body>

<div id="onboarding-overlay">
    <div id="onboarding-wizard">
        <div class="step" id="step-1">
            <img src="./logo.png" alt="Linen Logo" class="onboarding-logo">
            <h1>Linen</h1>
            <p>Your AI companion that remembers everything.</p>
            <button id="get-started">Get Started</button>
        </div>
        <div class="step" id="step-2">
            <button class="back-btn" id="back-from-step-2">â† Back</button>
            <h2>Choose Your AI</h2>
            <p>Pick your favorite AI assistant. All are supported by Linen.</p>
            <div class="ai-provider-grid">
                <button class="ai-provider-btn" data-provider="gemini" id="provider-gemini">
                    <span class="provider-icon">ğŸ”µ</span>
                    <span class="provider-name">Gemini</span>
                    <span class="provider-info">Free tier available</span>
                </button>
                <button class="ai-provider-btn" data-provider="chatgpt" id="provider-openai">
                    <span class="provider-icon">ğŸŸ¢</span>
                    <span class="provider-name">ChatGPT</span>
                    <span class="provider-info">GPT-4 / GPT-4 Turbo</span>
                </button>
                <button class="ai-provider-btn" data-provider="claude" id="provider-claude">
                    <span class="provider-icon">ğŸ”´</span>
                    <span class="provider-name">Claude</span>
                    <span class="provider-info">Claude Pro / API</span>
                </button>
                <button class="ai-provider-btn" data-provider="deepseek" id="provider-deepseek">
                    <span class="provider-icon">ğŸŸ </span>
                    <span class="provider-name">DeepSeek</span>
                    <span class="provider-info">Free & affordable</span>
                </button>
            </div>
            <div id="provider-setup">
                <!-- Provider-specific setup will be shown here -->
            </div>
            <p class="error-message" id="onboarding-error"></p>
        </div>
        <div class="step" id="step-3">
            <button class="back-btn" id="back-from-step-3">â† Back</button>
            <h2>Install as App</h2>
            <p>What device are you using?</p>
            <div class="device-selector">
                <button data-device="android">Android</button>
                <button data-device="ios">iOS</button>
            </div>
            <div id="android-instructions" class="instructions">
                <h4 style="margin-bottom: 0.5rem;">Android (Chrome)</h4>
                <ol>
                    <li>In Chrome, tap the <strong>three-dot menu (â‹®)</strong> in the top-right corner</li>
                    <li>Tap <strong>"Add to Home screen"</strong></li>
                    <li>A popup will appearâ€”tap the <strong>"Add"</strong> button</li>
                    <li>Linen will appear on your home screen as an app icon</li>
                </ol>
                <p style="font-size: 0.85rem; color: var(--text-light); margin-top: 0.5rem;"><em>Tip: Chrome may show an automatic "Install" prompt when you visit Linenâ€”you can tap that too!</em></p>
            </div>
            <div id="ios-instructions" class="instructions">
                <h4 style="margin-bottom: 0.5rem;">iOS (Safari)</h4>
                <ol>
                    <li>In Safari, tap the <strong>Share button</strong> (looks like a box with an arrow â¬†ï¸) at the bottom of your screen</li>
                    <li>Scroll down in the share menu and tap <strong>"Add to Home Screen"</strong></li>
                    <li>You can customize the app name if you want</li>
                    <li>Tap the <strong>"Add"</strong> button in the top-right corner</li>
                    <li>Linen will appear on your home screen as an app icon</li>
                </ol>
                <p style="font-size: 0.85rem; color: var(--text-light); margin-top: 0.5rem;"><em>Tip: You can also use Chrome, Firefox, or Edge instead of Safariâ€”they all work the same way!</em></p>
            </div>
            <div class="onboarding-nav">
                <button id="finish-onboarding">Done</button>
            </div>
        </div>
        <div class="step-indicator">
            <span class="dot active"></span>
            <span class="dot"></span>
            <span class="dot"></span>
        </div>
    </div>
</div>

<div id="pitch-modal" class="modal pitch-accordion">
    <h2>Welcome to Linen</h2>
    <p>Your AI companion that respects your privacy.</p>

    <!-- Accordion Container -->
    <div class="accordion-container">
        <!-- Accordion Sections -->
        <div class="accordion-item">
            <button class="accordion-header" data-section="about">
                <span>ğŸ“± About Linen</span>
                <span class="accordion-icon">â–¼</span>
            </button>
            <div class="accordion-content" id="about">
                <p>Linen is a personal AI assistant that actually respects your privacy. Unlike other apps, everything you talk to Linen about stays on your deviceâ€”we don't sell your data or train on your conversations. It learns who you are over time, remembers what matters to you, and helps with reminders, planning, or just being there when you need support. Think of it as an AI that's actually on your side.</p>
            </div>
        </div>

        <div class="accordion-item">
            <button class="accordion-header" data-section="start">
                <span>âš¡ Start Chatting Now</span>
                <span class="accordion-icon">â–¼</span>
            </button>
            <div class="accordion-content" id="start">
                <p>Start chatting right now with Linen's built-in AI. It's a great listener and helpful friend. Want even smarter features? Add your favorite AI provider's API key anytime to unlock memories, reminders, and deeper conversations.</p>
                <p style="font-size: 0.9rem; color: #999;"><strong>Your conversations with Linen always stay private on your deviceâ€”the API key only tells Linen which AI service you prefer to use.</strong></p>
            </div>
        </div>

        <div class="accordion-item">
            <button class="accordion-header" data-section="ai">
                <span>ğŸ¤– Works With Your Favorite AI</span>
                <span class="accordion-icon">â–¼</span>
            </button>
            <div class="accordion-content" id="ai">
                <div class="provider-badges">
                    <span class="badge">ğŸ”µ Gemini</span>
                    <span class="badge">ğŸŸ¢ ChatGPT</span>
                    <span class="badge">ğŸ”´ Claude</span>
                    <span class="badge">ğŸŸ  DeepSeek</span>
                </div>
            </div>
        </div>

        <div class="accordion-item">
            <button class="accordion-header" data-section="features">
                <span>âœ¨ Key Features</span>
                <span class="accordion-icon">â–¼</span>
            </button>
            <div class="accordion-content" id="features">
                <ul>
                    <li>ğŸ”’ Privacy First</li>
                    <li>ğŸ§  Personalized</li>
                    <li>ğŸ‘¤ You Own Your Data</li>
                    <li>ğŸ¤– Use Your Favorite AI</li>
                    <li>ğŸ’¬ Start Chatting Immediately</li>
                </ul>
            </div>
        </div>
    </div>

    <div class="pitch-buttons">
        <button id="close-pitch-modal" class="button-primary">Start Chatting</button>
        <button id="add-api-key-btn" class="button-secondary">Add My API Key</button>
    </div>
</div>

<div id="trial-limit-modal" class="modal">
    <h2>Free Preview Complete</h2>
    <p>You've used your 3 free chats. Get your own API key to continue chatting unlimitedly.</p>
    <a href="https://aistudio.google.com/app/apikey" target="_blank" class="button-primary">Get Free API Key</a>
    <button id="close-trial-modal" class="button-primary">Close</button>
</div>

<div id="re-enter-key-modal" class="modal">
    <h2>Invalid API Key</h2>
    <p>Your API key is no longer working. Please enter a new one to continue.</p>
    <input type="password" id="re-enter-api-key" placeholder="Paste your new API key here">
    <button id="save-re-enter-api-key">Save Key</button>
    <p class="error-message" id="re-enter-error"></p>
</div>

<div id="voice-modal" class="modal voice-lightbox">
    <button class="close-modal" id="close-voice-modal">Ã—</button>
    <h2>Voice Input</h2>
    <div id="lightbox-voice-display" class="lightbox-voice-display">ğŸ¤ Listening...</div>
    <button id="lightbox-stop-btn" class="button-primary">Stop Recording</button>
</div>

<div id="crisis-modal" class="modal crisis-modal">
    <button class="close-modal" id="close-crisis-modal">Ã—</button>
    <h2 style="color: #ff6b6b;">You're Not Alone</h2>
    <p style="color: #fff; font-size: 1.1rem; margin: 1.5rem 0;">If you're in crisis, please reach out to someone who can help:</p>
    <div class="crisis-resources">
        <div class="resource">
            <h3>United States</h3>
            <p><strong>988 Suicide & Crisis Lifeline</strong></p>
            <p>Call or text 988 (available 24/7)</p>
            <p><a href="https://988lifeline.org" target="_blank" style="color: #4a9eff;">988lifeline.org</a></p>
        </div>
        <div class="resource">
            <h3>International</h3>
            <p><strong>Find Your Country's Crisis Line</strong></p>
            <p><a href="https://findahelpline.com" target="_blank" style="color: #4a9eff;">findahelpline.com</a></p>
            <p><a href="https://www.befrienders.org" target="_blank" style="color: #4a9eff;">befrienders.org</a></p>
        </div>
        <div class="resource">
            <h3>Text-Based Support</h3>
            <p><strong>Crisis Text Line</strong></p>
            <p>Text HOME to 741741 (US)</p>
            <p><a href="https://www.crisistextline.org" target="_blank" style="color: #4a9eff;">crisistextline.org</a></p>
        </div>
    </div>
    <p style="color: #ddd; margin-top: 2rem; font-size: 0.95rem;">I'm here to listen and support you, but if you're in immediate danger, please call emergency services (911 in US) or go to your nearest emergency room.</p>
    <button id="acknowledge-crisis" class="button-primary">I'm Safe / Need to Talk</button>
</div>


<div id="add-agent-modal" class="modal">
    <button class="close-modal" id="close-add-agent">Ã—</button>
    <h2>Add New Agent</h2>
    <div class="form-group">
        <label for="agent-name">Agent Name:</label>
        <input type="text" id="agent-name" placeholder="e.g., My Claude, ChatGPT Pro">
    </div>
    <div class="form-group">
        <label for="agent-type">AI Provider:</label>
        <select id="agent-type">
            <option value="">Select a provider</option>
            <option value="gemini">Google Gemini</option>
            <option value="openai">OpenAI (ChatGPT)</option>
            <option value="claude">Anthropic Claude</option>
            <option value="deepseek">DeepSeek</option>
            <option value="openrouter">OpenRouter</option>
        </select>
    </div>
    <div class="form-group">
        <label for="agent-api-key">API Key:</label>
        <input type="password" id="agent-api-key" placeholder="Paste your API key">
    </div>
    <div class="form-group">
        <label for="agent-model">Model (optional):</label>
        <input type="text" id="agent-model" placeholder="e.g., gpt-4, claude-3-opus">
    </div>
    <div class="form-group">
        <label>
            <input type="checkbox" id="agent-primary">
            Set as primary agent
        </label>
    </div>
    <button id="save-new-agent" class="button-primary">Add Agent</button>
    <p class="error-message" id="add-agent-error"></p>
</div>

<div id="app-container">
    <header>
        <div class="header-logo-container">
            <img src="./logo.png" alt="Linen Logo" id="logo" class="interactive-logo">
            <div id="logo-menu" class="logo-menu hidden">
                <button id="logo-memories" class="menu-item">ğŸ“š Memories</button>
                <button id="logo-new-chat" class="menu-item">ğŸ’¬ New Chat</button>
                <button id="logo-settings" class="menu-item">âš™ Settings</button>
            </div>
        </div>
    </header>

    <main class="main-content" id="chat-view">
        <div id="chat-messages"></div>
        <div id="chat-input-area">
            <!-- Default state: Two buttons -->
            <div id="input-buttons" class="input-buttons">
                <button id="chat-type" class="input-btn" title="Type message">Text</button>
                <button id="chat-talk" class="input-btn" title="Voice input">Talk</button>
            </div>

            <!-- Text input mode -->
            <div id="text-input-mode" class="input-mode" style="display: none;">
                <textarea id="chat-input" placeholder="Ask me anything..."></textarea>
                <div class="input-actions">
                    <button id="mode-switcher" class="mode-btn" title="Switch mode">+</button>
                    <button id="send-btn" class="send-btn">Send</button>
                </div>
            </div>

            <!-- Voice input mode -->
            <div id="voice-input-mode" class="input-mode" style="display: none;">
                <div id="voice-status-display" class="voice-status-display">ğŸ¤ Listening...</div>
                <div class="input-actions">
                    <button id="voice-mode-switcher" class="mode-btn" title="Switch mode">+</button>
                    <button id="stop-voice-btn" class="send-btn">Stop</button>
                </div>
            </div>
        </div>
    </main>

    <div id="voice-status"></div>

    <!-- Modals and Panels -->
    <div id="modal-backdrop"></div>

    <aside id="memories-panel">
        <button class="close-panel" id="close-memories">Ã—</button>
        <input id="memory-search" placeholder="Search memories...">
        <div id="memories-list">No memories yet.</div>
    </aside>

    <div class="modal" id="settings-modal">
        <button class="close-modal" id="close-settings-modal">Ã—</button>
        <h3 style="color: var(--accent); margin-bottom: 1rem;">ğŸ“± Installation</h3>
        <button id="install-app-btn" class="button-primary" style="width: 100%; margin-bottom: 1rem; background: var(--accent); color: var(--bg);">Install Linen as App</button>
        <hr>
        <h3 style="color: var(--accent); margin-bottom: 1rem;">ğŸ¤– AI Agents</h3>
        <button id="add-agent-btn" class="button-primary" style="width: 100%; margin-bottom: 1rem; background: var(--accent); color: var(--bg);">+ Add New Agent</button>
        <div id="agents-list" style="max-height: 200px; overflow-y: auto; margin-bottom: 1rem;"></div>
        <hr>
        <input id="api-key-input" placeholder="Paste Gemini API key (Legacy)">
        <button id="save-api-key">Save API Key</button>
        <button id="clear-chat-history">Clear Chat History</button>
        <button id="export-data">Export Memories</button>
        <button id="clear-data">Clear All Data</button>
        <hr>
        <div id="contact-form">
            <h3>Contact Support</h3>
            <form action="https://formspree.io/f/xaqdnyzw" method="POST">
                <input type="text" name="name" placeholder="Your Name" required>
                <input type="email" name="email" placeholder="Your Email" required>
                <textarea name="message" placeholder="Your Message" required></textarea>
                <button type="submit">Send</button>
            </form>
        </div>
        <hr>
        <div id="suggestions-form">
            <h3>ğŸ’¡ Suggestions & Ideas</h3>
            <textarea id="suggestion-text" placeholder="What would make Linen better for you?" style="min-height: 100px;"></textarea>
            <button id="submit-suggestion">Send Suggestion</button>
            <p id="suggestion-status" style="font-size: 0.85rem; color: #999; margin-top: 0.5rem;"></p>
        </div>
        <hr>
        <div id="about-section" style="text-align: center;">
            <h3 style="color: var(--accent); margin-bottom: 0.5rem;">â„¹ï¸ About Linen</h3>
            <p style="font-size: 0.9rem; color: var(--text-light); margin-bottom: 1rem;">Powered by <a href="https://www.anthropic.com/" target="_blank" style="color: var(--accent); text-decoration: none;">Anthropic's Claude</a> AI. Built with care.</p>
            <p style="font-size: 0.75rem; color: #666; cursor: help;" title="Created with care by someone who believes in privacy-first AI.">
                âœ¨ Made with passion
            </p>
        </div>
        <p id="version-info">v1.1.2 [beta]</p>
    </div>
</div>

<div id="toast"></div>

<script src="./app.js"></script>
</body>
</html>